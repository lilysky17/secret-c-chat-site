<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C Practice Tool</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1 style="text-align: center;">C Practice Compiler</h1>

  <div id="main-container">
    <textarea id="code" placeholder="Write your C code here..."></textarea>
    <button onclick="generateRandomCode()">Generate Random C Code</button>
  </div>

  <div id="chat-container" style="display: none;">
    <h3>Output Console</h3>
    <div id="chat-messages"></div>
    <input id="chat-input" type="text" placeholder="Type C input here..." onkeydown="handleKey(event)" />
    <button onclick="sendMessage()">Run</button>
  </div>

  <!-- Firebase config file -->
  <script type="module" src="firebase-config.js"></script>

  <!-- Main JS -->
  <script>
    const codeInput = document.getElementById("code");
    const chatContainer = document.getElementById("chat-container");
    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");

    const secretCode = "/open";

    function handleKey(event) {
      if (event.key === "Enter") {
        if (chatInput.value.trim() === secretCode) {
          chatContainer.style.display = "block";
          chatInput.value = "";
          chatInput.placeholder = "Write C commands...";
        }
      }
    }

    function generateRandomCode() {
      const samples = [
        "#include<stdio.h>\nint main() {\n  printf(\"Hello, world!\\n\");\n  return 0;\n}",
        "#include<stdio.h>\nint main() {\n  int a=5,b=10;\n  printf(\"Sum: %d\\n\",a+b);\n  return 0;\n}",
        "#include<stdio.h>\nint main() {\n  for(int i=0;i<5;i++) printf(\"%d \",i);\n  return 0;\n}"
      ];
      document.getElementById("code").value = samples[Math.floor(Math.random() * samples.length)];
    }

    // Firebase realtime chat logic
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcGGjLZE3lk4gkPEN0EEis6rLV-hTHRqs",
      authDomain: "secret-chat-d58c2.firebaseapp.com",
      databaseURL: "https://secret-chat-d58c2-default-rtdb.firebaseio.com",
      projectId: "secret-chat-d58c2",
      storageBucket: "secret-chat-d58c2.appspot.com",
      messagingSenderId: "1028244379630",
      appId: "1:1028244379630:web:d059a9bfbe7f78eb9620ff"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const msgRef = ref(db, "messages");

    onChildAdded(msgRef, (data) => {
      const msg = data.val();
      const msgElem = document.createElement("div");
      msgElem.textContent = msg.text;
      chatMessages.appendChild(msgElem);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    });

    function sendMessage() {
      const text = chatInput.value.trim();
      if (text !== "") {
        push(msgRef, { text });
        chatInput.value = "";
      }
    }
  </script>
</body>
</html>
